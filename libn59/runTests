test () {
  c=${i#tests/}
  c=${c%.c}
  gcc -Wall -Iinclude/. -Llibs -ln59 tests/$c.c
  ./a.out > tmp
  wc=`diff tests/golden/$c.golden tmp | wc -l`
  if [ $wc = 0 ]
  then
    echo "$c: PASS"
  else
    echo "$c: *** FAIL ***"
  fi
}

test_all () {
  for i in tests/*.c ;
  do
    test $i
    echo ""
  done
}

if [ "$1" == "" ]
then
  test_all
else
  if [[ "$1" == *"test" ]]
  then
    i=$1
  else
    i=n_$1_test
  fi
  test $i
fi
